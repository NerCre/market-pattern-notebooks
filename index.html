<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgeScope - Trade Judge &amp; Note</title>
  <!-- Base stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js for charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <h1 class="app-title">
      EdgeScope
      <span class="app-subtitle">Trade Judge&amp; Note</span>
    </h1>
    <!-- Tab navigation -->
    <div class="tabs">
      <button class="tab-button active" data-tab="entry">📥 entry</button>
      <button class="tab-button" data-tab="exit">✅ exit</button>
      <button class="tab-button" data-tab="stats">📊 Stats</button>
    </div>

    <!-- Entry Tab -->
    <section id="tab-entry" class="tab-content active">
      <h2 class="tab-header">entry（エントリー入力）</h2>
      <div class="entry-grid">
        <!-- Basic entry information -->
        <div class="entry-basic card">
          <h3>エントリー情報</h3>
          <div class="form-group">
            <label for="datetimeEntry">エントリー日時</label>
            <input id="datetimeEntry" type="datetime-local">
          </div>
          <div class="form-group">
            <label for="symbol">銘柄</label>
            <select id="symbol">
              <option value="nk225mc">nk225mc</option>
              <option value="nk225m">nk225m</option>
              <option value="nk225">nk225</option>
            </select>
          </div>
          <div class="form-group">
            <label for="timeframe">時間足</label>
            <select id="timeframe">
              <option value="1分">1分</option>
              <option value="3分">3分</option>
              <option value="5分">5分</option>
              <option value="15分">15分</option>
              <option value="30分">30分</option>
              <option value="1時間" selected>1時間</option>
              <option value="4時間">4時間</option>
              <option value="日足">日足</option>
            </select>
          </div>
          <div class="form-group">
            <label for="tradeType">取引区分</label>
            <select id="tradeType">
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
            </select>
          </div>
          <div class="form-group">
            <label for="directionPlanned">エントリー方向</label>
            <select id="directionPlanned">
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="entryPrice">エントリー価格</label>
            <input id="entryPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="size">枚数</label>
            <input id="size" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="feePerUnit">1枚あたりの手数料</label>
            <input id="feePerUnit" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="plannedStopPrice">想定ストップ価格</label>
            <input id="plannedStopPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="plannedLimitPrice">指値価格</label>
            <input id="plannedLimitPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="cutLossPrice">ロスカット価格</label>
            <input id="cutLossPrice" type="number" inputmode="decimal">
          </div>
          <!-- 判定条件 -->
          <div class="form-group">
            <label for="minWinRate">最低勝率 (%)</label>
            <input id="minWinRate" type="number" inputmode="decimal" value="30" placeholder="例: 30">
          </div>
        </div>
        <!-- Indicators -->
        <div class="entry-indicators card">
          <h3>インジケーター</h3>
          <div class="form-group">
            <label for="prevWave">直前の波</label>
            <select id="prevWave">
              <option value="">選択してください</option>
              <option value="HH">HH</option>
              <option value="HL">HL</option>
              <option value="LL">LL</option>
              <option value="LH">LH</option>
            </select>
          </div>
          <div class="form-group">
            <label for="trend_5_20_40">EMA5/20/40トレンド</label>
            <select id="trend_5_20_40">
              <option value="">選択してください</option>
              <option value="Stage1">Stage1</option>
              <option value="Stage2">Stage2</option>
              <option value="Stage3">Stage3</option>
              <option value="Stage4">Stage4</option>
              <option value="Stage5">Stage5</option>
              <option value="Stage6">Stage6</option>
            </select>
          </div>
          <div class="form-group">
            <label for="price_vs_ema200">価格 vs EMA200</label>
            <select id="price_vs_ema200">
              <option value="">選択してください</option>
              <option value="above">EMA200より上</option>
              <option value="below">EMA200より下</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ema_band_color">EMA Band</label>
            <select id="ema_band_color">
              <option value="">選択してください</option>
              <option value="dark_green">濃緑（強い上昇）</option>
              <option value="light_green">薄緑（上昇気味）</option>
              <option value="neutral">中立</option>
              <option value="light_red">薄赤（下落気味）</option>
              <option value="dark_red">濃赤（強い下落）</option>
            </select>
          </div>
          <div class="form-group">
            <label for="zone">Pivot×ATRゾーン</label>
            <select id="zone">
              <option value="">選択してください</option>
              <option value="pivot">pivot</option>
              <option value="pivot_R1">pivot～R1</option>
              <option value="R1">R1</option>
              <option value="R1_R2">R1～R2</option>
              <option value="R2">R2</option>
              <option value="R2_HBOP">R2～HBOP</option>
              <option value="HBOP">HBOP</option>
              <option value="over_HBOP">HBOP以上</option>
              <option value="pivot_S1">pivot～S1</option>
              <option value="S1">S1</option>
              <option value="S1_S2">S1～S2</option>
              <option value="S2">S2</option>
              <option value="S2_LBOP">S2～LBOP</option>
              <option value="LBOP">LBOP</option>
              <option value="under_LBOP">LBOP以下</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cmf_sign">CMF圏域</label>
            <select id="cmf_sign">
              <option value="">選択してください</option>
              <option value="positive">プラス圏</option>
              <option value="near_zero">ゼロ付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cmf_sma_dir">CMF SMA方向</label>
            <select id="cmf_sma_dir">
              <option value="">選択してください</option>
              <option value="gc">GoldCross</option>
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
              <option value="dc">DeadCross</option>
            </select>
          </div>
          <div class="form-group">
            <label for="macd_state">MACD状態</label>
            <select id="macd_state">
              <option value="">選択してください</option>
              <option value="post_gc">GoldCross後</option>
              <option value="neutral">中立</option>
              <option value="post_dc">DeadCross後</option>
            </select>
          </div>
          <div class="form-group">
            <label for="roc_sign">ROC圏域</label>
            <select id="roc_sign">
              <option value="">選択してください</option>
              <option value="positive">プラス圏</option>
              <option value="near_zero">ゼロ付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </div>
          <div class="form-group">
            <label for="roc_sma_dir">ROC SMA方向</label>
            <select id="roc_sma_dir">
              <option value="">選択してください</option>
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
            </select>
          </div>
          <div class="form-group">
            <label for="rsi_zone">RSIゾーン</label>
            <select id="rsi_zone">
              <option value="">選択してください</option>
              <option value="over70">70以上</option>
              <option value="50to70">50〜70</option>
              <option value="around50">50付近</option>
              <option value="30to50">30〜50</option>
              <option value="under30">30以下</option>
            </select>
          </div>
        </div>
        <!-- Memo and attachments -->
        <div class="entry-memo card">
          <h3>メモ・添付</h3>
          <div class="form-group">
            <label for="marketMemo">相場状況メモ</label>
            <textarea id="marketMemo" rows="5"></textarea>
          </div>
          <div class="form-group">
            <label for="notionUrl">Notion URL</label>
            <input id="notionUrl" type="text" placeholder="https://...">
          </div>
          <div class="form-group">
            <label for="imageData">画像添付</label>
            <input id="imageData" type="file" accept="image/*">
          </div>
          <div class="form-group">
            <button id="voiceRecordButton" type="button" class="secondary-button">🎤 音声入力</button>
            <span id="voiceStatus" class="voice-status"></span>
          </div>
        </div>
      </div>
      <!-- Entry actions -->
      <div class="entry-actions button-row">
        <button id="btnEvaluate" type="button" class="primary-button">判定する</button>
        <button id="btnEvaluateAndSave" type="button" class="primary-button">判定してエントリーを保存</button>
        <button id="btnClearEntry" type="button" class="secondary-button">このエントリー入力をクリア</button>
      </div>
      <!-- Judge result display -->
      <div class="judge-result card">
        <h3>判定結果</h3>
        <div id="judgeResultContent">
          <p>判定がここに表示されます。</p>
        </div>
      </div>
    </section>

    <!-- Exit Tab -->
    <section id="tab-exit" class="tab-content">
      <h2 class="tab-header">exit（結果入力）</h2>
      <div class="result-grid">
        <!-- List of entries for exit -->
        <div class="result-list card">
          <h3>エントリー選択</h3>
          <div class="form-group">
            <label><input type="checkbox" id="filterUnclosed"> 未決済のみ</label>
          </div>
          <div class="form-group">
            <label for="selectExitRecord">エントリーリスト</label>
            <select id="selectExitRecord" size="8" style="width: 100%;"></select>
          </div>
        </div>
        <!-- Result form -->
        <div class="result-form card">
          <h3>結果入力</h3>
          <div class="form-group">
            <label for="datetimeExit">決済日時</label>
            <input id="datetimeExit" type="datetime-local">
          </div>
          <div class="form-group">
            <label for="exitPrice">実際の決済価格</label>
            <input id="exitPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-group readonly-field">
            <label>エントリー方向</label>
            <span id="directionTakenDisplay">—</span>
          </div>
          <div class="form-group readonly-field">
            <label>枚数</label>
            <span id="sizeDisplay">—</span>
          </div>
          <div class="form-group readonly-field">
            <label>1枚あたりの手数料</label>
            <span id="feePerUnitDisplay">—</span>
          </div>
          <div class="form-group">
            <label for="highDuringTrade">トレード中の最高値</label>
            <input id="highDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="lowDuringTrade">トレード中の最安値</label>
            <input id="lowDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="resultMemo">メモ</label>
            <textarea id="resultMemo" rows="4"></textarea>
          </div>
          <div class="form-group readonly-field">
            <label>損益 (円)</label>
            <span id="profitDisplay">—</span>
          </div>
        </div>
      </div>
      <div class="result-actions button-row">
        <button id="btnSaveResult" type="button" class="primary-button">結果を保存</button>
        <button id="btnClearResult" type="button" class="secondary-button">この結果入力をクリア</button>
      </div>
    </section>

    <!-- Stats Tab -->
    <section id="tab-stats" class="tab-content">
      <h2 class="tab-header">Stats（一覧・分析・統計）</h2>
      <!-- Filters and Table -->
      <div class="stats-section">
        <div class="stats-filters card">
          <h3>フィルタ</h3>
          <div class="filter-grid">
            <div class="form-group">
              <label for="filterSymbol">銘柄</label>
              <select id="filterSymbol">
                <option value="all">全て</option>
                <option value="nk225mc">nk225mc</option>
                <option value="nk225m">nk225m</option>
                <option value="nk225">nk225</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filterTradeType">取引区分</label>
              <select id="filterTradeType">
                <option value="all">全て</option>
                <option value="real">リアル</option>
                <option value="virtual">バーチャル</option>
                <option value="practice">プラクティス</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filterDirection">結果方向</label>
              <select id="filterDirection">
                <option value="all">全て</option>
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filterFrom">期間開始</label>
              <input id="filterFrom" type="date">
            </div>
            <div class="form-group">
              <label for="filterTo">期間終了</label>
              <input id="filterTo" type="date">
            </div>
          </div>
          <div class="form-group">
            <button id="btnApplyFilters" type="button" class="primary-button">フィルタ適用</button>
          </div>
        </div>
        <!-- Table -->
        <div class="stats-table card">
          <h3>トレード一覧</h3>
          <div class="table-container">
            <table id="recordsTable">
              <thead>
                <tr>
                  <th>エントリー日時</th>
                  <th>銘柄</th>
                  <th>時間足</th>
                  <th>取引区分</th>
                  <th>エントリー方向</th>
                  <th>結果方向</th>
                  <th>損益 (円)</th>
                  <th>推奨</th>
                  <th>完了</th>
                  <th colspan="3">操作</th>
                </tr>
              </thead>
              <tbody id="recordsTableBody">
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- Charts -->
      <div class="charts-column">
        <div class="chart-card card">
          <h3>累積損益</h3>
          <canvas id="chartProfit"></canvas>
        </div>
        <div class="chart-card card">
          <h3>方向別勝率＆平均損益</h3>
          <canvas id="chartLongShort"></canvas>
        </div>
        <div class="chart-card card">
          <h3>時間足別勝率</h3>
          <canvas id="chartTimeframe"></canvas>
        </div>
      </div>
      <!-- JSON export/import -->
      <div class="json-actions button-row">
        <button id="btnExportJson" type="button" class="primary-button">JSON エクスポート</button>
        <button id="btnImportJson" type="button" class="primary-button">JSON インポート</button>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button id="btnDeleteAll" type="button" class="secondary-button">全件削除</button>
      </div>
    </section>

    <!-- Disclaimer -->
    <footer class="app-disclaimer">
      本アプリの判定結果・分析結果は、過去データ等に基づく参考情報であり、将来の収益や損失の発生について何ら保証するものではありません。すべての投資判断・トレード判断はご自身の責任において行ってください。本アプリの制作者および公開者は、本アプリの利用により生じたいかなる損失についても一切の責任を負いません。
    </footer>
  </div>
  <!-- Application script -->
  <script src="script.js"></script>
</body>
</html>
