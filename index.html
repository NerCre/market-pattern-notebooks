<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>トレード判定＋学習＆トレードノート</title>
  <!-- Chart.js CDN for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1>トレード判定＆ノート</h1>
      <nav class="tab-navigation">
        <button id="tab-new" class="tab-button active">📋 新規記録</button>
        <button id="tab-list" class="tab-button">📊 一覧・分析</button>
      </nav>
    </header>

    <!-- New Record Tab -->
    <section id="new-record" class="tab-section">
      <form id="record-form">
        <!-- 基本情報入力ブロック -->
        <div class="panel">
          <h2>基本情報</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="datetime">日付・時間<span class="required">＊</span></label>
              <input type="datetime-local" id="datetime" name="datetime" required>
            </div>
            <div class="form-group">
              <label for="symbol">銘柄<span class="required">＊</span></label>
              <input type="text" id="symbol" name="symbol" value="nk225mc" required>
            </div>
            <div class="form-group">
              <label for="timeframe">時間足<span class="required">＊</span></label>
              <select id="timeframe" name="timeframe" required>
                <option value="1m">1分</option>
                <option value="5m">5分</option>
                <option value="15m">15分</option>
                <option value="30m">30分</option>
                <option value="1h">1時間</option>
                <option value="1d">日足</option>
              </select>
            </div>
            <div class="form-group">
              <label for="trade-type">取引区分<span class="required">＊</span></label>
              <select id="trade-type" name="tradeType" required>
                <option value="real">リアル</option>
                <option value="virtual">バーチャル</option>
                <option value="practice">プラクティス</option>
              </select>
            </div>
            <div class="form-group">
              <label for="direction-planned">想定方向<span class="required">＊</span></label>
              <select id="direction-planned" name="direction_planned" required>
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジで様子見</option>
              </select>
            </div>
            <div class="form-group">
              <label for="expected-move-value">予想する値動きの大きさ</label>
              <input type="number" id="expected-move-value" name="expected_move_value" placeholder="例: 300">
            </div>
            <div class="form-group">
              <label for="expected-move-unit">単位</label>
              <select id="expected-move-unit" name="expected_move_unit">
                <option value="円">円</option>
                <option value="ポイント">ポイント</option>
                <option value="R">R</option>
              </select>
            </div>
          </div>
        </div>

        <!-- インジケーター入力ブロック -->
        <div class="panel">
          <h2>インジケーター入力</h2>
          <!-- トレンド系（EMA） -->
          <div class="subpanel">
            <h3>トレンド系（EMA）</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="trend-5-20-40">EMA5・EMA20・EMA40の並び<span class="required">＊</span></label>
                <select id="trend-5-20-40" name="trend_5_20_40" required>
                  <option value="bull">上昇トレンド（EMA5＞EMA20＞EMA40）</option>
                  <option value="bear">下降トレンド（EMA5＜EMA20＜EMA40）</option>
                  <option value="mixed">もみ合い・交錯</option>
                </select>
              </div>
              <div class="form-group">
                <label for="price-vs-ema200">価格とEMA200の位置関係<span class="required">＊</span></label>
                <select id="price-vs-ema200" name="price_vs_ema200" required>
                  <option value="above">価格はEMA200より上</option>
                  <option value="below">価格はEMA200より下</option>
                </select>
              </div>
              <div class="form-group">
                <label for="ema-band-color">EMA Band</label>
                <select id="ema-band-color" name="ema_band_color">
                  <option value="dark_green">濃緑（強い上昇）</option>
                  <option value="light_green">薄緑（上昇気味）</option>
                  <option value="neutral">0付近（中立〜転換）</option>
                  <option value="light_red">薄赤（下落気味）</option>
                  <option value="dark_red">濃赤（強い下落）</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ボラティリティ・価格位置（Pivot × ATR帯） -->
          <div class="subpanel">
            <h3>ボラティリティ・価格位置（Pivot × ATR帯）</h3>
            <div class="form-group full-width">
              <label for="zone">現在価格の位置（Pivot/ATRゾーン）</label>
              <select id="zone" name="zone">
                <option value="pivot">pivot</option>
                <option value="pivot-R1">pivot〜R1</option>
                <option value="R1">R1</option>
                <option value="R1-R2">R1〜R2</option>
                <option value="R2">R2</option>
                <option value="R2-HBOP">R2〜HBOP</option>
                <option value="HBOP">HBOP</option>
                <option value="above-HBOP">HBOP以上</option>
                <option value="pivot-S1">pivot〜S1</option>
                <option value="S1">S1</option>
                <option value="S1-S2">S1〜S2</option>
                <option value="S2">S2</option>
                <option value="S2-LBOP">S2〜LBOP</option>
                <option value="LBOP">LBOP</option>
                <option value="below-LBOP">LBOP以下</option>
              </select>
            </div>
          </div>

          <!-- フロー系（CMF） -->
          <div class="subpanel">
            <h3>フロー系（CMF）</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="cmf-sign">CMFの圏域</label>
                <select id="cmf-sign" name="cmf_sign">
                  <option value="positive">プラス圏（0より上）</option>
                  <option value="near_zero">ゼロ付近（-0.05〜+0.05）</option>
                  <option value="negative">マイナス圏（0より下）</option>
                </select>
              </div>
              <div class="form-group">
                <label for="cmf-sma-dir">CMF SMA hist の向き</label>
                <select id="cmf-sma-dir" name="cmf_sma_dir">
                  <option value="up">上昇</option>
                  <option value="down">下降</option>
                  <option value="flat">ほぼ横ばい</option>
                </select>
              </div>
            </div>
          </div>

          <!-- モメンタム系（MACD / ROC） -->
          <div class="subpanel">
            <h3>モメンタム系（MACD / ROC）</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="macd-state">MACDの状態</label>
                <select id="macd-state" name="macd_state">
                  <option value="post_gc">GC後（ゴールデンクロス後）</option>
                  <option value="post_dc">DC後（デッドクロス後）</option>
                  <option value="neutral">どちらでもない（中立）</option>
                </select>
              </div>
              <div class="form-group">
                <label for="roc-sign">ROCの圏域</label>
                <select id="roc-sign" name="roc_sign">
                  <option value="positive">プラス圏（0より上）</option>
                  <option value="near_zero">ゼロ付近（-0.05〜+0.05）</option>
                  <option value="negative">マイナス圏（0より下）</option>
                </select>
              </div>
              <div class="form-group">
                <label for="roc-sma-dir">ROC SMA hist の向き</label>
                <select id="roc-sma-dir" name="roc_sma_dir">
                  <option value="up">上昇</option>
                  <option value="down">下降</option>
                  <option value="flat">ほぼ横ばい</option>
                </select>
              </div>
            </div>
          </div>

          <!-- オシレーター系（RSI） -->
          <div class="subpanel">
            <h3>オシレーター系（RSI）</h3>
            <div class="form-group full-width">
              <label for="rsi-zone">RSIゾーン</label>
              <select id="rsi-zone" name="rsi_zone">
                <option value="under30">0〜30</option>
                <option value="30to70">30〜70</option>
                <option value="over70">70以上</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 相場状況メモ -->
        <div class="panel">
          <h2>相場状況メモ</h2>
          <textarea id="market-memo" name="market_memo" rows="3" placeholder="日足・1時間足の状況やニュース要因など自由に記録"></textarea>
        </div>

        <!-- エントリー・結果入力ブロック -->
        <div class="panel">
          <h2>エントリー・結果</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="entry-price">エントリー価格</label>
              <input type="number" step="0.01" id="entry-price" name="entry_price">
            </div>
            <div class="form-group">
              <label for="stop-price">想定ストップ価格</label>
              <input type="number" step="0.01" id="stop-price" name="stop_price">
            </div>
            <div class="form-group">
              <label for="take-price">想定利確価格</label>
              <input type="number" step="0.01" id="take-price" name="take_price">
            </div>
            <div class="form-group">
              <label for="exit-price">実際の決済価格</label>
              <input type="number" step="0.01" id="exit-price" name="exit_price">
            </div>
            <div class="form-group">
              <label for="profit">損益</label>
              <input type="number" step="0.01" id="profit" name="profit">
            </div>
            <div class="form-group">
              <label for="direction-taken">実際に取った方向</label>
              <select id="direction-taken" name="direction_taken">
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </div>
          </div>
          <div class="form-group full-width">
            <label for="note">メモ（反省・気づきなど）</label>
            <textarea id="note" name="note" rows="3" placeholder="自由入力"></textarea>
          </div>
        </div>

        <!-- 画像・音声入力 -->
        <div class="panel">
          <h2>画像・音声入力</h2>
          <div class="file-audio-wrapper">
            <div class="form-group">
              <label for="image-input">チャート画像を添付</label>
              <input type="file" id="image-input" accept="image/*">
              <img id="image-preview" class="image-preview" alt="プレビュー" />
            </div>
            <div class="form-group">
              <label>音声入力</label>
              <button type="button" id="voice-btn" class="voice-button" disabled>🎤 音声入力</button>
              <small id="voice-status" class="voice-status"></small>
            </div>
          </div>
        </div>

        <!-- 判定ボタンと結果表示 -->
        <div class="panel">
          <h2>判定</h2>
          <div class="action-buttons">
            <button type="button" id="predict-only" class="primary-btn">判定する</button>
            <button type="button" id="predict-save" class="secondary-btn">判定して記録に保存</button>
          </div>
          <div id="prediction-result" class="prediction-result"></div>
        </div>
      </form>
    </section>

    <!-- List & Analysis Tab -->
    <section id="list-analysis" class="tab-section hidden">
      <div class="panel filter-panel">
        <h2>フィルタ</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="filter-symbol">銘柄</label>
            <input type="text" id="filter-symbol" placeholder="例: nk225mc">
          </div>
          <div class="form-group">
            <label for="filter-timeframe">時間足</label>
            <select id="filter-timeframe">
              <option value="">全て</option>
              <option value="1m">1分</option>
              <option value="5m">5分</option>
              <option value="15m">15分</option>
              <option value="30m">30分</option>
              <option value="1h">1時間</option>
              <option value="1d">日足</option>
            </select>
          </div>
          <div class="form-group">
            <label for="filter-trade-type">取引区分</label>
            <select id="filter-trade-type">
              <option value="">全て</option>
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
            </select>
          </div>
          <div class="form-group">
            <label for="filter-date-from">開始日</label>
            <input type="date" id="filter-date-from">
          </div>
          <div class="form-group">
            <label for="filter-date-to">終了日</label>
            <input type="date" id="filter-date-to">
          </div>
          <div class="form-group">
            <label for="sort-profit">損益ソート</label>
            <select id="sort-profit">
              <option value="">指定なし</option>
              <option value="asc">昇順</option>
              <option value="desc">降順</option>
            </select>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" id="apply-filter" class="primary-btn">フィルタ適用</button>
          <button type="button" id="reset-filter" class="secondary-btn">リセット</button>
        </div>
      </div>

      <!-- テーブル表示 -->
      <div class="panel table-panel">
        <h2>トレード一覧</h2>
        <div class="table-wrapper">
          <table id="record-table">
            <thead>
              <tr>
                <th>日時</th>
                <th>銘柄</th>
                <th>時間足</th>
                <th>取引区分</th>
                <th>方向</th>
                <th>損益</th>
                <th>R倍率</th>
                <th>推奨方向</th>
              </tr>
            </thead>
            <tbody>
              <!-- rows inserted here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- グラフ表示 -->
      <div class="panel charts-panel">
        <h2>分析グラフ</h2>
        <div class="chart-container">
          <canvas id="cum-profit-chart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="direction-stats-chart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="timeframe-stats-chart"></canvas>
        </div>
      </div>

      <!-- エクスポート／インポート -->
      <div class="panel export-import-panel">
        <h2>データ同期</h2>
        <div class="action-buttons">
          <button type="button" id="export-json" class="primary-btn">全データをJSONとしてエクスポート</button>
          <button type="button" id="import-json-btn" class="secondary-btn">JSONからインポート</button>
          <input type="file" id="import-json-file" accept="application/json" class="hidden" />
        </div>
        <div id="import-msg" class="import-message"></div>
      </div>
    </section>
  </div>

  <script src="script.js"></script>
</body>
</html>