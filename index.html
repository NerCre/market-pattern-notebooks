<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgeScope – Trade Judge &amp; Note</title>
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <header class="app-header">
        <!-- Title is split over two lines intentionally to avoid awkward wrapping on small screens -->
        <h1 class="title-line1">EdgeScope</h1>
        <h2 class="title-line2">Trade Judge &amp; Note</h2>
    </header>
    <nav class="tabs">
      <button class="tab-button active" data-tab="entry">📥 entry</button>
      <button class="tab-button" data-tab="exit">✅ exit</button>
      <button class="tab-button" data-tab="stats">📊 Stats</button>
    </nav>
    <!-- Entry Tab Content -->
   <section id="entry-tab" class="tab-content active">
      <form id="entry-form" class="form-section">
        <!-- Error message placeholder -->
        <div id="entry-error" class="error-message" aria-live="assertive"></div>
        <div class="form-columns">
          <!-- Column 1: basic trade info -->
          <div class="form-column">
          <h3>基本情報</h3>
          <label>
            銘柄
            <select name="symbol" id="entry-symbol">
              <option value="nk225mc">NK225マイクロ</option>
              <option value="nk225m">NK225ミニ</option>
              <option value="nk225">NK225</option>
            </select>
            <div class="form-field">
              <label for="datetimeEntry">エントリー日時<span class="required">*</span></label>
              <input id="datetimeEntry" name="datetimeEntry" type="datetime-local" required>
            </div>
          <div class="form-field">
            <label for="symbol">銘柄</label>
            <select id="symbol">
              <option value="nk225mc" selected>nk225mc</option>
              <option value="nk225m">nk225m</option>
              <option value="nk225">nk225</option>
            </select>
          </div>
          <div class="form-field">
            <label for="timeframe">時間足</label>
            <select id="timeframe">
              <option value="1分">1分</option>
              <option value="3分">3分</option>
              <option value="5分">5分</option>
              <option value="15分">15分</option>
              <option value="30分">30分</option>
              <option value="1時間" selected>1時間</option>
              <option value="4時間">4時間</option>
              <option value="日足">日足</option>
            </select>
          </div>
          <div class="form-field">
            <label for="tradeType">種別</label>
            <select id="tradeType">
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
            </select>
          </div>
          <div class="form-field">
            <label for="directionPlanned">予定方向</label>
            <select id="directionPlanned">
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-field">
            <label for="entryPrice">エントリー価格<span class="required">*</span></label>
            <input id="entryPrice" name="entryPrice" type="number" inputmode="decimal" required>
          </div>
          <div class="form-field">
            <label for="size">枚数<span class="required">*</span></label>
            <input id="size" name="size" type="number" inputmode="decimal" required>
          </div>
          <div class="form-field">
            <label for="feePerUnit">1枚あたり手数料<span class="required">*</span></label>
            <input id="feePerUnit" name="feePerUnit" type="number" inputmode="decimal" required>
          </div>
          <div class="form-field">
            <label for="plannedStopPrice">ストップ予想価格</label>
            <input id="plannedStopPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="plannedLimitPrice">指値価格</label>
            <input id="plannedLimitPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="cutLossPrice">ロスカット価格</label>
            <input id="cutLossPrice" type="number" inputmode="decimal">
          </div>
        </div>
        <!-- Middle: Indicators -->
        <div class="card entry-indicators">
          <h2>インジケーター</h2>
          <div class="form-field">
            <label for="prevWave">波動</label>
            <select id="prevWave">
              <option value="">選択してください</option>
              <option value="Wave1">第1波</option>
              <option value="HH">HH</option>
              <option value="HL">HL</option>
              <option value="LL">LL</option>
              <option value="LH">LH</option>
            </select>
          </div>
          <div class="form-field">
            <label for="trend_5_20_40">トレンド(5-20-40)</label>
            <select id="trend_5_20_40">
              <option value="Stage1">Stage1</option>
              <option value="Stage2">Stage2</option>
              <option value="Stage3">Stage3</option>
              <option value="Stage4">Stage4</option>
              <option value="Stage5">Stage5</option>
              <option value="Stage6">Stage6</option>
            </select>
          </div>
          <div class="form-field">
            <label for="price_vs_ema200">価格 vs EMA200</label>
            <select id="price_vs_ema200">
              <option value="above">上</option>
              <option value="below">下</option>
            </select>
          </div>
          <div class="form-field">
            <label for="ema_band_color">EMAバンド色</label>
            <select id="ema_band_color">
              <option value="濃緑">濃緑</option>
              <option value="薄緑">薄緑</option>
              <option value="0付近">0付近</option>
              <option value="薄赤">薄赤</option>
              <option value="濃赤">濃赤</option>
            </select>
          </div>
          <div class="form-field">
            <label for="zone">ゾーン</label>
            <select id="zone">
              <option value="pivot">pivot</option>
              <option value="pivot_R1">pivot_R1</option>
              <option value="R1">R1</option>
              <option value="R1_R2">R1_R2</option>
              <option value="R2">R2</option>
              <option value="R2_HBOP">R2_HBOP</option>
              <option value="HBOP">HBOP</option>
              <option value="over_HBOP">over_HBOP</option>
              <option value="pivot_S1">pivot_S1</option>
              <option value="S1">S1</option>
              <option value="S1_S2">S1_S2</option>
              <option value="S2">S2</option>
              <option value="S2_LBOP">S2_LBOP</option>
              <option value="LBOP">LBOP</option>
              <option value="under_LBOP">under_LBOP</option>
            </select>
          </div>
          <div class="form-field">
            <label for="cmf_sign">CMFサイン</label>
            <select id="cmf_sign">
              <option value="positive">positive</option>
              <option value="near_zero">near_zero</option>
              <option value="negative">negative</option>
            </select>
          </div>
          <div class="form-field">
            <label for="cmf_sma_dir">CMF SMA方向</label>
            <select id="cmf_sma_dir">
              <option value="gc">GC</option>
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
              <option value="dc">DC</option>
            </select>
          </div>
          <div class="form-field">
            <label for="macd_state">MACD状態</label>
            <select id="macd_state">
              <option value="post_gc">post_gc</option>
              <option value="post_dc">post_dc</option>
              <option value="neutral">neutral</option>
            </select>
          </div>
          <div class="form-field">
            <label for="roc_sign">ROCサイン</label>
            <select id="roc_sign">
              <option value="positive">positive</option>
              <option value="near_zero">near_zero</option>
              <option value="negative">negative</option>
            </select>
          </div>
          <div class="form-field">
            <label for="roc_sma_dir">ROC SMA方向</label>
            <select id="roc_sma_dir">
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
            </select>
          </div>
          <div class="form-field">
            <label for="rsi_zone">RSIゾーン</label>
            <select id="rsi_zone">
              <option value="70〜">70〜</option>
              <option value="50〜70">50〜70</option>
              <option value="50付近">50付近</option>
              <option value="30〜50">30〜50</option>
              <option value="0〜30">0〜30</option>
            </select>
          </div>
          <h3>判定設定</h3>
          <div class="form-field">
            <label for="minWinRate">最低勝率 (%)</label>
            <input type="number" id="entry-minWinRate" inputmode="decimal" value="30" min="0" max="100">
          </div>
        </div>
        <!-- Right: Memo & Image -->
        <div class="card entry-memo">
          <h2>メモ・画像</h2>
          <div class="form-field">
            <label for="marketMemo">メモ</label>
            <textarea id="marketMemo" rows="4"></textarea>
          </div>
          <div class="form-field">
            <label for="notionUrl">Notion URL</label>
            <input id="notionUrl" type="text">
          </div>
          <div class="form-field">
            <label for="imageData">画像</label>
            <input id="imageData" type="file" accept="image/*">
          </div>
        </div>
      </div>
      <!-- Buttons row -->
      <div class="button-row">
        <button type="button" id="btn-analyze">判定する</button>
        <button type="button" id="btn-analyze-save">判定してエントリーを保存</button>
        <button type="button" id="btn-entry-clear">このエントリー入力をクリア</button>
      </div>
      <!-- Results card -->
      <div id="analysis-result" class="analysis-result" hidden>
        <h3>判定結果</h3>
        <div class="analysis-grid">
          <div><span class="label">判定銘柄:</span> <span id="res-symbol"></span></div>
          <div><span class="label">疑似ケース件数:</span> <span id="res-caseCount"></span></div>
          <div><span class="label">推奨方向:</span> <span id="res-recommendation"></span></div>
          <div><span class="label">勝率:</span> <span id="res-winRate"></span></div>
          <div><span class="label">信頼度:</span> <span id="res-confidence"></span></div>
          <div><span class="label">推定値幅:</span> <span id="res-expectedMove"></span></div>
          <div><span class="label">平均利益:</span> <span id="res-avgProfit"></span></div>
          <div><span class="label">平均損失:</span> <span id="res-avgLoss"></span></div>
          <!-- Confidence bar -->
          <div class="confidence-bar-wrap">
            <div class="confidence-bar" id="confidence-bar"></div>
          </div>
        </div>
      </form>
    </section>

    <!-- Exit Tab Content -->
    <section id="tab-exit" class="tab-content">
      <div class="exit-container">
        <div class="card exit-select">
          <h2>レコード選択</h2>
          <select id="exitRecordSelect"></select>
        </div>
        <div class="card exit-form">
          <h2>結果入力</h2>
          <div class="form-field">
            <label for="datetimeExit">終了日時</label>
            <input id="datetimeExit" type="datetime-local">
          </div>
          <div class="form-field">
            <label for="exitPrice">終了価格</label>
            <input id="exitPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label>エントリー方向</label>
            <div id="exitDirectionDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label>枚数</label>
            <div id="exitSizeDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label>手数料</label>
            <div id="exitFeeDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label for="highDuringTrade">期間中高値</label>
            <input id="highDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="lowDuringTrade">期間中安値</label>
            <input id="lowDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="resultMemo">結果メモ</label>
            <textarea id="resultMemo" rows="3"></textarea>
          </div>
          <div class="form-field">
            <label>損益</label>
            <div id="exitProfitDisp" class="display-field"></div>
          </div>
          <div class="exit-actions">
            <button id="btnSaveExit">結果を保存</button>
            <button id="btnClearExit">この結果入力をクリア</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Tab Content -->
    <section id="tab-stats" class="tab-content">
      <div class="stats-container">
        <div class="card stats-filters">
          <h3>フィルタ</h3>
          <div class="form-field">
            <label for="filterSymbol">銘柄</label>
            <select id="filterSymbol">
              <option value="all">全て</option>
              <option value="nk225mc">nk225mc</option>
              <option value="nk225m">nk225m</option>
              <option value="nk225">nk225</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterType">種別</label>
            <select id="filterType">
              <option value="all">全て</option>
              <option value="real">real</option>
              <option value="virtual">virtual</option>
              <option value="practice">practice</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterDirection">方向</label>
            <select id="filterDirection">
              <option value="all">全て</option>
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterResult">結果</label>
            <select id="filterResult">
              <option value="all">全て</option>
              <option value="with">結果あり</option>
              <option value="without">結果なし</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterStart">開始日</label>
            <input id="filterStart" type="date">
          </div>
          <div class="form-field">
            <label for="filterEnd">終了日</label>
            <input id="filterEnd" type="date">
          </div>
          <div class="button-row filter-buttons">
            <button type="button" id="btn-apply-filter">フィルタ適用</button>
            <button type="button" id="btn-clear-filter">フィルタ解除</button>
            <button type="button" id="btn-export-json">JSONエクスポート</button>
            <button type="button" id="btnExportCsv" class="btn">CSVエクスポート</button>
            <label class="import-label">
              JSONインポート
              <input type="file" id="import-file" accept="application/json" hidden>
              <button type="button" id="btn-import-json">JSONインポート</button>
            </label>
          </div>
          <div id="import-result" class="import-result"></div>
        </div>
        <div class="card stats-summary">
          <h2>分析結果</h2>
          <div id="statsSummaryTable"></div>
        </div>
        <div class="stats-summary" id="stats-summary"></div>
        <div class="table-wrap">
            <table id="stats-table">
                <thead>
                    <tr>
                        <th>作成日</th>
                        <th>銘柄</th>
                        <th>時間足</th>
                        <th>方向</th>
                        <th>エントリー価格</th>
                        <th>決済価格</th>
                        <th>枚数</th>
                        <th>手数料/枚</th>
                        <th>利益</th>
                        <th>疑似ケース</th>
                        <th>勝率</th>
                        <th>推定値幅</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows generated via JS -->
                </tbody>
            </table>
        </div>
        <div class="card stats-charts">
          <h2>グラフ</h2>
          <canvas id="chartCumulative" height="200"></canvas>
          <canvas id="chartDirection" height="200"></canvas>
          <canvas id="chartTimeframe" height="200"></canvas>
        </div>
        <div class="card stats-table">
          <h2>トレード一覧</h2>
          <div id="recordsTableWrapper"></div>
        </div>
      </div>
    </section>

    <footer class="app-disclaimer">
      本アプリの判定結果・分析結果は参考情報であり、将来の損益を保証しません。
      投資判断は自己責任で行ってください。本アプリの利用により生じたいかなる損失についても責任を負いません。
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
