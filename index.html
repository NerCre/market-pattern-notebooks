<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgeScope – Trade Judge &amp; Note</title>
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="app">
    <header class="app-header">
        <!-- Title is split over two lines intentionally to avoid awkward wrapping on small screens -->
        <h1 class="title-line1">EdgeScope</h1>
        <h2 class="title-line2">Trade Judge &amp; Note</h2>
    </header>
    <nav class="tabs">
      <button class="tab-button active" data-tab="entry">📥 entry</button>
      <button class="tab-button" data-tab="exit">✅ exit</button>
      <button class="tab-button" data-tab="stats">📊 Stats</button>
    </nav>
    <!-- Entry Tab Content -->
    <section id="entry-tab" class="tab-content active">
      <form id="entry-form" class="form-section">
        <!-- Error message placeholder -->
        <div id="entry-error" class="error-message" aria-live="assertive"></div>
        <div class="form-columns">
          <!-- Column 1: basic trade info -->
          <div class="form-column">
          <h3>基本情報</h3>
          <label>
            エントリー日時
            <input type="datetime-local" id="entry-datetime" required>
          </label>
          <label>
            銘柄
            <select name="symbol" id="entry-symbol">
              <option value="nk225mc">NK225マイクロ</option>
              <option value="nk225m">NK225ミニ</option>
              <option value="nk225">NK225</option>
          </label>
          <label>
            時間足
            <select name="timeframe" id="entry-timeframe">
              <option value="1分">1分</option>
              <option value="5分">5分</option>
              <option value="15分">15分</option>
              <option value="30分">30分</option>
              <option value="1時間" selected>1時間</option>
              <option value="4時間">4時間</option>
              <option value="日足">日足</option>
          </label>
          <label>
            トレード区分
            <select name="tradeType" id="entry-tradeType">
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
          </label>
          <label>
            取引方向
            <select name="direction" id="entry-direction">
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
          </label>
          <label>
            エントリー価格
            <input type="number" inputmode="decimal" id="entry-price" required>
          </label>
          <label>
            枚数
            <input type="number" inputmode="decimal" id="entry-size" required>
          </label>
          <label>
            1枚あたり手数料
            <input type="number" inputmode="decimal" id="entry-fee" required>
          </label>
          <label>
            ストップ予想価格
            <input type="number" inputmode="decimal" id="entry-StopPrice" required>
          </label>
          <label>
            指値価格
            <input type="number" inputmode="decimal" id="entry-LimitPrice" required>
          </label>
          <label>
            ロスカット価格
            <input type="number" inputmode="decimal" id="entry-LossPrice" required>
          </label>

        <!-- Column 2: indicator inputs -->
        <div class="form-column">
          <h3>インジケーター</h3>
          <label>
            波動
            <select id="ind-prevWave">
              <option value="">選択してください</option>
              <option value="Wave1">第1波</option>
              <option value="Wave2">第2波</option>
              <option value="Wave3">第3波</option>
              <option value="Wave4">第4波</option>
              <option value="Wave5">第5波</option>
              <option value="Wave6">第6波</option>
              <option value="Wave7">第7波～</option>
              <option value="HH">HH</option>
              <option value="HL">HL</option>
              <option value="LL">LL</option>
              <option value="LH">LH</option>
            </select>
          </label>
          <label>
            大循環分析
            <select id="ind-trend_5_20_40">
              <option value="">選択してください</option>
              <option value="Stage1">Stage1</option>
              <option value="Stage2">Stage2</option>
              <option value="Stage3">Stage3</option>
              <option value="Stage4">Stage4</option>
              <option value="Stage5">Stage5</option>
              <option value="Stage6">Stage6</option>
            </select>
          </label>
          <label>
            価格 vs EMA200
            <select id="ind-prevWave">
              <option value="">選択してください</option>
              <option value="above">上</option>
              <option value="below">下</option>
            </select>
          </label>
          <label>
            ATR指標
            <select id="ind-atr_zone">
              <option value="">選択してください</option>
              <option value="pivot">pivot</option>
              <option value="pivot_R1">pivot～R1</option>
              <option value="R1">R1</option>
              <option value="R1_R2">R1～R2</option>
              <option value="R2">R2</option>
              <option value="R2_HBOP">R2～HBOP</option>
              <option value="HBOP">HBOP</option>
              <option value="over_HBOP">HBOP～</option>
              <option value="pivot_S1">pivot～S1</option>
              <option value="S1">S1</option>
              <option value="S1_S2">S1～S2</option>
              <option value="S2">S2</option>
              <option value="S2_LBOP">S2～LBOP</option>
              <option value="LBOP">LBOP</option>
              <option value="under_LBOP">LBOP～</option>
            </select>
          </label>
          <label>
            EMA Band
            <select id="ind-prevWave">
              <option value="">選択してください</option>
              <option value="High_Green">濃緑（強い上昇）</option>
              <option value="Low_Green">薄緑（弱い上昇）</option>
              <option value="GR">0付近</option>
              <option value="Low_Red">薄赤（弱い下降）</option>
              <option value="High_Red">濃赤（強い下降）</option>
            </select>
          </label>
          <label>
            CMF実数
            <select id="ind-cmf_sign">
              <option value="">選択してください</option>
              <option value="positive">プラス圏</option>
              <option value="near_zero">0付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </label>
          <label>
            CMF SMA hist
            <select id="ind-cmf_sma">
              <option value="">選択してください</option>
              <option value="up">上昇</option>
              <option value="gc">GoldCross</option>
              <option value="flat">横ばい</option>
              <option value="dc">DeadCross</option>
              <option value="down">下降</option>
            </select>
          </label>
          <label>
            MACD
            <select id="ind-MACD">
              <option value="">選択してください</option>
              <option value="post_gc">GoldCross後</option>
              <option value="neutral">横ばい</option>
              <option value="post_dc">DeadCross後</option>
            </select>
          </label>
          <label>
            ROC実数
            <select id="ind-roc_sign">
              <option value="">選択してください</option>
              <option value="positive">プラス圏</option>
              <option value="near_zero">0付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </label>
          <label>
            ROC SMA hist
            <select id="ind-roc_sma">
              <option value="">選択してください</option>
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
            </select>
          </label>
          <label>
            RSI
            <select id="ind-rsi_zone">
              <option value="">選択してください</option>
              <option value="upper_70">70〜</option>
              <option value="50_70">50〜70</option>
              <option value="near_50">50付近</option>
              <option value="30_50">30〜50</option>
              <option value="lower_30">0〜30</option>
            </select>
          </label>
        </div>

        <!-- Column 3: additional settings -->
        <div class="form-column">
          <h3>判定設定・その他</h3>
          <label>
            最低勝率 (%)
            <input type="number" id="entry-minWinRate" inputmode="decimal" value="30" min="0" max="100">
          </label>
          <label>
            メモ
            <textarea id="marketMemo" rows="4"></textarea>
          </label>
          <label>
            Notion URL
            <input type="text" id="notionUrl" >
          </label>
          <label>
            画像
            <input type="file" id="imageData" accept="image/*">
          </label>
        </div>

      <!-- Buttons row -->
      <div class="button-row">
        <button type="button" id="btn-analyze">判定する</button>
        <button type="button" id="btn-analyze-save">判定してエントリーを保存</button>
        <button type="button" id="btn-entry-clear">このエントリー入力をクリア</button>
      </div>

      <!-- Results card -->
      <div id="analysis-result" class="analysis-result" hidden>
        <h3>判定結果</h3>
        <div class="analysis-grid">
          <div><span class="label">判定銘柄:</span> <span id="res-symbol"></span></div>
          <div><span class="label">疑似ケース件数:</span> <span id="res-caseCount"></span></div>
          <div><span class="label">推奨方向:</span> <span id="res-recommendation"></span></div>
          <div><span class="label">勝率:</span> <span id="res-winRate"></span></div>
          <div><span class="label">信頼度:</span> <span id="res-confidence"></span></div>
          <div><span class="label">推定値幅:</span> <span id="res-expectedMove"></span></div>
          <div><span class="label">平均利益:</span> <span id="res-avgProfit"></span></div>
          <div><span class="label">平均損失:</span> <span id="res-avgLoss"></span></div>
          <!-- Confidence bar -->
          <div class="confidence-bar-wrap">
            <div class="confidence-bar" id="confidence-bar"></div>
          </div>
        </div>
      </form>
    </section>

    <!-- Exit Tab Content -->
    <section id="exit-tab" class="tab-content">
      <form id="exit-form" class="form-section">
        <div id="exit-error" class="error-message" aria-live="assertive"></div>
        <div class="exit-select-wrap">
          <label>
            未決済トレード
            <select id="exit-select">
              <!-- Options will be populated via JS -->
            </select>
          </label>
        </div>
        <!-- Exit details -->
        

        <div class="card exit-form">
          <h2>結果入力</h2>
          <div class="form-field">
            <label for="datetimeExit">終了日時</label>
            <input id="datetimeExit" type="datetime-local">
          </div>
          <div class="form-field">
            <label for="exitPrice">終了価格</label>
            <input id="exitPrice" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label>エントリー方向</label>
            <div id="exitDirectionDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label>枚数</label>
            <div id="exitSizeDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label>手数料</label>
            <div id="exitFeeDisp" class="display-field"></div>
          </div>
          <div class="form-field">
            <label for="highDuringTrade">期間中高値</label>
            <input id="highDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="lowDuringTrade">期間中安値</label>
            <input id="lowDuringTrade" type="number" inputmode="decimal">
          </div>
          <div class="form-field">
            <label for="resultMemo">結果メモ</label>
            <textarea id="resultMemo" rows="3"></textarea>
          </div>
          <div class="form-field">
            <label>損益</label>
            <div id="exitProfitDisp" class="display-field"></div>
          </div>
          <div class="exit-actions">
            <button id="btnSaveExit">結果を保存</button>
            <button id="btnClearExit">この結果入力をクリア</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Tab Content -->
    <section id="tab-stats" class="tab-content">
      <div class="stats-container">
        <div class="card stats-filters">
          <h3>フィルタ</h3>
          <div class="form-field">
            <label for="filterSymbol">銘柄</label>
            <select id="filterSymbol">
              <option value="all">全て</option>
              <option value="nk225mc">nk225mc</option>
              <option value="nk225m">nk225m</option>
              <option value="nk225">nk225</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterType">種別</label>
            <select id="filterType">
              <option value="all">全て</option>
              <option value="real">real</option>
              <option value="virtual">virtual</option>
              <option value="practice">practice</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterDirection">方向</label>
            <select id="filterDirection">
              <option value="all">全て</option>
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterResult">結果</label>
            <select id="filterResult">
              <option value="all">全て</option>
              <option value="with">結果あり</option>
              <option value="without">結果なし</option>
            </select>
          </div>
          <div class="form-field">
            <label for="filterStart">開始日</label>
            <input id="filterStart" type="date">
          </div>
          <div class="form-field">
            <label for="filterEnd">終了日</label>
            <input id="filterEnd" type="date">
          </div>
          <div class="button-row filter-buttons">
            <button type="button" id="btn-apply-filter">フィルタ適用</button>
            <button type="button" id="btn-clear-filter">フィルタ解除</button>
            <button type="button" id="btn-export-json">JSONエクスポート</button>
            <button type="button" id="btnExportCsv" class="btn">CSVエクスポート</button>
            <label class="import-label">
              JSONインポート
              <input type="file" id="import-file" accept="application/json" hidden>
              <button type="button" id="btn-import-json">JSONインポート</button>
            </label>
          </div>
          <div id="import-result" class="import-result"></div>
        </div>
        <div class="card stats-summary">
          <h2>分析結果</h2>
          <div id="statsSummaryTable"></div>
        </div>
        <div class="stats-summary" id="stats-summary"></div>
        <div class="table-wrap">
            <table id="stats-table">
                <thead>
                    <tr>
                        <th>作成日</th>
                        <th>銘柄</th>
                        <th>時間足</th>
                        <th>方向</th>
                        <th>エントリー価格</th>
                        <th>決済価格</th>
                        <th>枚数</th>
                        <th>手数料/枚</th>
                        <th>利益</th>
                        <th>疑似ケース</th>
                        <th>勝率</th>
                        <th>推定値幅</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows generated via JS -->
                </tbody>
            </table>
        </div>
        <div class="card stats-charts">
          <h2>グラフ</h2>
          <canvas id="chartCumulative" height="200"></canvas>
          <canvas id="chartDirection" height="200"></canvas>
          <canvas id="chartTimeframe" height="200"></canvas>
        </div>
        <div class="card stats-table">
          <h2>トレード一覧</h2>
          <div id="recordsTableWrapper"></div>
        </div>
      </div>
    </section>

    <footer class="app-disclaimer">
      本アプリの判定結果・分析結果は参考情報であり、将来の損益を保証しません。
      投資判断は自己責任で行ってください。本アプリの利用により生じたいかなる損失についても責任を負いません。
    </footer>
  </div>

  <script src="script.js"></script>
</body>
</html>
