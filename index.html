<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeScope Trade Judge &amp; Note</title>
    <!-- Main stylesheet -->
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="app">
        <header class="app-header">
            <!-- Title is split over two lines intentionally to avoid awkward wrapping on small screens -->
            <h1 class="title-line1">EdgeScope</h1>
            <h2 class="title-line2">Trade Judge &amp; Note</h2>
        </header>
        <nav class="tabs">
            <button class="tab-button active" data-target="entry-tab">エントリー</button>
            <button class="tab-button" data-target="exit-tab">決済</button>
            <button class="tab-button" data-target="stats-tab">Stats</button>
        </nav>
        <!-- Entry Tab Content -->
        <section id="entry-tab" class="tab-content active">
            <form id="entry-form" class="form-section">
                <!-- Error message placeholder -->
                <div id="entry-error" class="error-message" aria-live="assertive"></div>
                <div class="form-columns">
                    <!-- Column 1: basic trade info -->
                    <div class="form-column">
                        <h3>基本情報</h3>
                        <label>
                            銘柄
                            <select name="symbol" id="entry-symbol">
                                <option value="nk225mc">NK225マイクロ</option>
                                <option value="nk225m">NK225ミニ</option>
                                <option value="nk225">NK225</option>
                            </select>
                        </label>
                        <label>
                            時間足
                            <select name="timeframe" id="entry-timeframe">
                                <option value="1時間">1時間</option>
                                <option value="4時間">4時間</option>
                            </select>
                        </label>
                        <label>
                            取引方向
                            <select name="direction" id="entry-direction">
                                <option value="long">ロング</option>
                                <option value="short">ショート</option>
                                <option value="flat">フラット</option>
                            </select>
                        </label>
                        <label>
                            エントリー日時
                            <input type="datetime-local" id="entry-datetime" required>
                        </label>
                        <label>
                            エントリー価格
                            <input type="number" inputmode="decimal" id="entry-price" required>
                        </label>
                        <label>
                            枚数
                            <input type="number" inputmode="decimal" id="entry-size" required>
                        </label>
                        <label>
                            1枚あたりの手数料
                            <input type="number" inputmode="decimal" id="entry-fee" required>
                        </label>
                    </div>
                    <!-- Column 2: indicator inputs -->
                    <div class="form-column">
                        <h3>インジケーター</h3>
                        <label>
                            prevWave
                            <input type="number" id="ind-prevWave">
                        </label>
                        <label>
                            trend_5_20_40
                            <select id="ind-trend">
                                <option value="up">上昇</option>
                                <option value="down">下降</option>
                                <option value="flat">横ばい</option>
                            </select>
                        </label>
                        <label>
                            price_vs_ema200
                            <select id="ind-priceVsEma200">
                                <option value="above">上</option>
                                <option value="below">下</option>
                                <option value="equal">同水準</option>
                            </select>
                        </label>
                        <label>
                            ema_band_color
                            <select id="ind-emaColor">
                                <option value="green">緑</option>
                                <option value="red">赤</option>
                                <option value="yellow">黄</option>
                                <option value="blue">青</option>
                            </select>
                        </label>
                        <label>
                            zone
                            <select id="ind-zone">
                                <option value="upper">上部</option>
                                <option value="middle">中部</option>
                                <option value="lower">下部</option>
                            </select>
                        </label>
                        <label>
                            cmf_sign
                            <select id="ind-cmfSign">
                                <option value="positive">正</option>
                                <option value="negative">負</option>
                                <option value="zero">ゼロ</option>
                            </select>
                        </label>
                        <label>
                            cmf_sma_dir
                            <select id="ind-cmfSmaDir">
                                <option value="up">上向き</option>
                                <option value="down">下向き</option>
                                <option value="flat">横ばい</option>
                            </select>
                        </label>
                        <label>
                            macd_state
                            <select id="ind-macdState">
                                <option value="bullish">強気</option>
                                <option value="bearish">弱気</option>
                                <option value="neutral">中立</option>
                            </select>
                        </label>
                        <label>
                            roc_sign
                            <select id="ind-rocSign">
                                <option value="positive">正</option>
                                <option value="negative">負</option>
                                <option value="zero">ゼロ</option>
                            </select>
                        </label>
                        <label>
                            roc_sma_dir
                            <select id="ind-rocSmaDir">
                                <option value="up">上向き</option>
                                <option value="down">下向き</option>
                                <option value="flat">横ばい</option>
                            </select>
                        </label>
                        <label>
                            rsi_zone
                            <select id="ind-rsiZone">
                                <option value="overbought">買われ過ぎ</option>
                                <option value="oversold">売られ過ぎ</option>
                                <option value="neutral">中立</option>
                            </select>
                        </label>
                    </div>
                    <!-- Column 3: additional settings -->
                    <div class="form-column">
                        <h3>判定設定</h3>
                        <label>
                            最低勝率 (%)
                            <input type="number" id="entry-minWinRate" inputmode="decimal" value="30" min="0" max="100">
                        </label>
                    </div>
                </div>
                <!-- Buttons row -->
                <div class="button-row">
                    <button type="button" id="btn-analyze">判定する</button>
                    <button type="button" id="btn-analyze-save">判定してエントリーを保存</button>
                    <button type="button" id="btn-entry-clear">このエントリー入力をクリア</button>
                </div>
                <!-- Results card -->
                <div id="analysis-result" class="analysis-result" hidden>
                    <h3>判定結果</h3>
                    <div class="analysis-grid">
                        <div><span class="label">判定銘柄:</span> <span id="res-symbol"></span></div>
                        <div><span class="label">疑似ケース件数:</span> <span id="res-caseCount"></span></div>
                        <div><span class="label">推奨方向:</span> <span id="res-recommendation"></span></div>
                        <div><span class="label">勝率:</span> <span id="res-winRate"></span></div>
                        <div><span class="label">信頼度:</span> <span id="res-confidence"></span></div>
                        <div><span class="label">推定値幅:</span> <span id="res-expectedMove"></span></div>
                        <div><span class="label">平均利益:</span> <span id="res-avgProfit"></span></div>
                        <div><span class="label">平均損失:</span> <span id="res-avgLoss"></span></div>
                        <!-- Confidence bar -->
                        <div class="confidence-bar-wrap">
                            <div class="confidence-bar" id="confidence-bar"></div>
                        </div>
                    </div>
                </div>
            </form>
        </section>
        <!-- Exit Tab Content -->
        <section id="exit-tab" class="tab-content">
            <form id="exit-form" class="form-section">
                <div id="exit-error" class="error-message" aria-live="assertive"></div>
                <div class="exit-select-wrap">
                    <label>
                        未決済トレード
                        <select id="exit-select">
                            <!-- Options will be populated via JS -->
                        </select>
                    </label>
                </div>
                <!-- Exit details -->
                <div id="exit-details" class="exit-details" hidden>
                    <div class="form-columns">
                        <div class="form-column">
                            <h3>決済情報</h3>
                            <label>
                                決済日時
                                <input type="datetime-local" id="exit-datetime">
                            </label>
                            <label>
                                決済価格
                                <input type="number" inputmode="decimal" id="exit-price">
                            </label>
                            <label>
                                トレード中高値
                                <input type="number" inputmode="decimal" id="exit-high">
                            </label>
                            <label>
                                トレード中安値
                                <input type="number" inputmode="decimal" id="exit-low">
                            </label>
                        </div>
                        <div class="form-column">
                            <h3>参考情報</h3>
                            <div><span class="label">方向:</span> <span id="exit-direction-display"></span></div>
                            <div><span class="label">エントリー価格:</span> <span id="exit-entryPrice-display"></span></div>
                            <div><span class="label">枚数:</span> <span id="exit-size-display"></span></div>
                            <div><span class="label">手数料/枚:</span> <span id="exit-fee-display"></span></div>
                        </div>
                    </div>
                    <div class="button-row">
                        <button type="button" id="btn-exit-save">決済保存</button>
                        <button type="button" id="btn-exit-clear">入力をクリア</button>
                    </div>
                </div>
            </form>
        </section>
        <!-- Stats Tab Content -->
        <section id="stats-tab" class="tab-content">
            <div class="stats-filters">
                <h3>フィルタ</h3>
                <div class="filter-grid">
                    <label>
                        銘柄
                        <select id="filter-symbol">
                            <option value="all">全て</option>
                            <option value="nk225mc">NK225マイクロ</option>
                            <option value="nk225m">NK225ミニ</option>
                            <option value="nk225">NK225</option>
                        </select>
                    </label>
                    <label>
                        時間足
                        <select id="filter-timeframe">
                            <option value="all">全て</option>
                            <option value="1時間">1時間</option>
                            <option value="4時間">4時間</option>
                        </select>
                    </label>
                    <label>
                        方向
                        <select id="filter-direction">
                            <option value="all">全て</option>
                            <option value="long">ロング</option>
                            <option value="short">ショート</option>
                            <option value="flat">フラット</option>
                        </select>
                    </label>
                    <label>
                        期間（開始）
                        <input type="date" id="filter-start">
                    </label>
                    <label>
                        期間（終了）
                        <input type="date" id="filter-end">
                    </label>
                </div>
                <div class="button-row filter-buttons">
                    <button type="button" id="btn-apply-filter">フィルタ適用</button>
                    <button type="button" id="btn-clear-filter">フィルタ解除</button>
                    <button type="button" id="btn-export-json">JSONエクスポート</button>
                    <label class="import-label">
                        JSONインポート
                        <input type="file" id="import-file" accept="application/json" hidden>
                        <button type="button" id="btn-import-json">JSONインポート</button>
                    </label>
                </div>
                <div id="import-result" class="import-result"></div>
            </div>
            <div class="stats-summary" id="stats-summary"></div>
            <div class="table-wrap">
                <table id="stats-table">
                    <thead>
                        <tr>
                            <th>作成日</th>
                            <th>銘柄</th>
                            <th>時間足</th>
                            <th>方向</th>
                            <th>エントリー価格</th>
                            <th>決済価格</th>
                            <th>枚数</th>
                            <th>手数料/枚</th>
                            <th>利益</th>
                            <th>疑似ケース</th>
                            <th>勝率</th>
                            <th>推定値幅</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table rows generated via JS -->
                    </tbody>
                </table>
            </div>
            <div class="chart-wrap">
                <canvas id="stats-chart" height="200"></canvas>
            </div>
        </section>
    </div>
    <footer class="app-footer">
        <p>本アプリの判定結果・分析結果は参考情報であり、将来の損益を保証しません。投資判断は自己責任で行ってください。本アプリの利用により生じたいかなる損失についても責任を負いません。</p>
    </footer>
    <!-- Main script -->
    <script src="script.js"></script>
</body>
</html>