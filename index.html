<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgeScope – Trade Judge &amp; Note</title>
  <link rel="stylesheet" href="style.css">
  <!-- Chart.js via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
  <!-- For icons on buttons we can optionally use emoji only -->
</head>
<body>
  <div class="app">
    <h1 class="app-title">
      EdgeScope
      <span class="app-subtitle">Trade Judge &amp; Note</span>
    </h1>

    <!-- Tab Buttons -->
    <div class="tabs">
      <button class="tab-button active" data-tab="entry">📥 エントリー入力</button>
      <button class="tab-button" data-tab="result">✅ 結果入力</button>
      <button class="tab-button" data-tab="analysis">📊 一覧・分析</button>
    </div>

    <!-- Entry Tab -->
    <section id="tab-entry" class="tab-content active">
      <h2 class="tab-heading">エントリー情報</h2>
      <div class="entry-grid">
        <!-- Basic Entry Information -->
        <div class="card entry-basic">
          <h3>基本情報</h3>
          <div class="form-group">
            <label for="datetimeEntry">エントリー日時</label>
            <input type="datetime-local" id="datetimeEntry" name="datetimeEntry">
          </div>
          <div class="form-group">
            <label for="symbol">銘柄</label>
            <input type="text" id="symbol" name="symbol" value="nk225mc">
          </div>
          <div class="form-group">
            <label for="timeframe">時間足</label>
            <select id="timeframe" name="timeframe">
              <option value="1分">1分</option>
              <option value="5分">5分</option>
              <option value="15分">15分</option>
              <option value="30分">30分</option>
              <option value="1時間">1時間</option>
              <option value="日足">日足</option>
            </select>
          </div>
          <div class="form-group">
            <label for="tradeType">取引区分</label>
            <select id="tradeType" name="tradeType">
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
            </select>
          </div>
          <div class="form-group">
            <label for="directionPlanned">エントリー方向</label>
            <select id="directionPlanned" name="directionPlanned">
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="entryPrice">エントリー価格</label>
            <input type="number" id="entryPrice" name="entryPrice" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="size">枚数</label>
            <input type="number" id="size" name="size" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="feePerUnit">1枚あたりの手数料</label>
            <input type="number" id="feePerUnit" name="feePerUnit" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="plannedStopPrice">想定ストップ価格</label>
            <input type="number" id="plannedStopPrice" name="plannedStopPrice" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="plannedLimitPrice">指値価格</label>
            <input type="number" id="plannedLimitPrice" name="plannedLimitPrice" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="cutLossPrice">ロスカット価格</label>
            <input type="number" id="cutLossPrice" name="cutLossPrice" inputmode="decimal">
          </div>
        </div>

        <!-- Indicators -->
        <div class="card entry-indicators">
          <h3>インジケーター</h3>
          <div class="form-group">
            <label for="trend_5_20_40">EMA5/20/40トレンド</label>
            <select id="trend_5_20_40" name="trend_5_20_40">
              <option value="Stage1">Stage1</option>
              <option value="Stage2">Stage2</option>
              <option value="Stage3">Stage3</option>
              <option value="Stage4">Stage4</option>
              <option value="Stage5">Stage5</option>
              <option value="Stage6">Stage6</option>
            </select>
          </div>
          <div class="form-group">
            <label for="price_vs_ema200">価格 vs EMA200</label>
            <select id="price_vs_ema200" name="price_vs_ema200">
              <option value="above">上</option>
              <option value="below">下</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ema_band_color">EMAバンド</label>
            <select id="ema_band_color" name="ema_band_color">
              <option value="dark_green">濃緑</option>
              <option value="light_green">薄緑</option>
              <option value="neutral">ニュートラル</option>
              <option value="light_red">薄赤</option>
              <option value="dark_red">濃赤</option>
            </select>
          </div>
          <div class="form-group">
            <label for="zone">Pivot×ATRゾーン</label>
            <select id="zone" name="zone">
              <option value="pivot">pivot</option>
              <option value="pivot_R1">pivot〜R1</option>
              <option value="R1">R1</option>
              <option value="R1_R2">R1〜R2</option>
              <option value="R2">R2</option>
              <option value="R2_HBOP">R2〜HBOP</option>
              <option value="HBOP">HBOP</option>
              <option value="over_HBOP">HBOP以上</option>
              <option value="pivot_S1">pivot〜S1</option>
              <option value="S1">S1</option>
              <option value="S1_S2">S1〜S2</option>
              <option value="S2">S2</option>
              <option value="S2_LBOP">S2〜LBOP</option>
              <option value="LBOP">LBOP</option>
              <option value="under_LBOP">LBOP以下</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cmf_sign">CMF圏域</label>
            <select id="cmf_sign" name="cmf_sign">
              <option value="positive">プラス圏</option>
              <option value="near_zero">ゼロ付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cmf_sma_dir">CMF SMA方向</label>
            <select id="cmf_sma_dir" name="cmf_sma_dir">
              <option value="gc">GC</option>
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
              <option value="dc">DC</option>
            </select>
          </div>
          <div class="form-group">
            <label for="macd_state">MACD状態</label>
            <select id="macd_state" name="macd_state">
              <option value="post_gc">GC後</option>
              <option value="post_dc">DC後</option>
              <option value="neutral">ニュートラル</option>
            </select>
          </div>
          <div class="form-group">
            <label for="roc_sign">ROC圏域</label>
            <select id="roc_sign" name="roc_sign">
              <option value="positive">プラス圏</option>
              <option value="near_zero">ゼロ付近</option>
              <option value="negative">マイナス圏</option>
            </select>
          </div>
          <div class="form-group">
            <label for="roc_sma_dir">ROC SMA方向</label>
            <select id="roc_sma_dir" name="roc_sma_dir">
              <option value="up">上昇</option>
              <option value="flat">横ばい</option>
              <option value="down">下降</option>
            </select>
          </div>
          <div class="form-group">
            <label for="rsi_zone">RSIゾーン</label>
            <select id="rsi_zone" name="rsi_zone">
              <option value="over70">70〜</option>
              <option value="50to70">50〜70</option>
              <option value="around50">50付近</option>
              <option value="30to50">30〜50</option>
              <option value="under30">0〜30</option>
            </select>
          </div>
        </div>

        <!-- Memo / Image / Voice -->
        <div class="card entry-memo">
          <h3>メモ・画像</h3>
          <div class="form-group">
            <label for="marketMemo">相場状況メモ</label>
            <textarea id="marketMemo" name="marketMemo" rows="4"></textarea>
          </div>
          <div class="form-group">
            <label for="notionUrl">Notion URL</label>
            <input type="text" id="notionUrl" name="notionUrl">
          </div>
          <div class="form-group">
            <label for="imageInput">画像添付</label>
            <input type="file" id="imageInput" name="imageInput" accept="image/*">
            <div id="imagePreview" class="image-preview"></div>
          </div>
          <div class="form-group">
            <button type="button" id="voiceInputBtn">🎤 音声入力</button>
          </div>
        </div>
      </div><!-- end entry-grid -->
      <div class="entry-actions button-row">
        <button id="judgeBtn" type="button">判定する</button>
        <button id="judgeSaveBtn" type="button">判定してエントリーを保存</button>
        <button id="clearEntryBtn" type="button">このエントリー入力をクリア</button>
      </div>
      <div id="judgeResult" class="card judge-result" style="display: none;">
        <div id="recommendationBadge" class="recommendation-badge"></div>
        <div id="expectedMove" class="expected-move"></div>
        <div id="confidenceBar" class="confidence-bar"></div>
        <div id="judgeReason" class="judge-reason"></div>
      </div>
    </section>

    <!-- Result Tab -->
    <section id="tab-result" class="tab-content">
      <h2 class="tab-heading">結果入力</h2>
      <div class="result-grid">
        <div class="card result-list">
          <h3>エントリー選択</h3>
          <div class="form-group">
            <label for="filterPending">未入力のみ</label>
            <input type="checkbox" id="filterPending" checked>
          </div>
          <div class="form-group">
            <select id="resultSelect" size="8" style="width:100%"></select>
          </div>
        </div>
        <div class="card result-form">
          <h3>結果詳細</h3>
          <div class="form-group">
            <label for="datetimeExit">決済日時</label>
            <input type="datetime-local" id="datetimeExit" name="datetimeExit">
          </div>
          <div class="form-group">
            <label for="exitPrice">決済価格</label>
            <input type="number" id="exitPrice" name="exitPrice" inputmode="decimal">
          </div>
          <div class="form-group">
            <label>エントリー方向</label>
            <input type="text" id="directionTaken" name="directionTaken" readonly>
          </div>
          <div class="form-group">
            <label>枚数</label>
            <input type="text" id="resultSize" name="resultSize" readonly>
          </div>
          <div class="form-group">
            <label>1枚あたりの手数料</label>
            <input type="text" id="resultFeePerUnit" name="resultFeePerUnit" readonly>
          </div>
          <div class="form-group">
            <label for="highDuringTrade">トレード中の最高値</label>
            <input type="number" id="highDuringTrade" name="highDuringTrade" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="lowDuringTrade">トレード中の最安値</label>
            <input type="number" id="lowDuringTrade" name="lowDuringTrade" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="resultMemo">結果メモ</label>
            <textarea id="resultMemo" name="resultMemo" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>損益</label>
            <input type="text" id="profitDisplay" name="profitDisplay" readonly>
          </div>
        </div>
      </div>
      <div class="result-actions button-row">
        <button id="saveResultBtn" type="button">結果を保存</button>
        <button id="clearResultBtn" type="button">この結果入力をクリア</button>
      </div>
    </section>

    <!-- Analysis Tab -->
    <section id="tab-analysis" class="tab-content">
      <h2 class="tab-heading">一覧・分析</h2>
      <!-- Filters and Table -->
      <div class="card analysis-filter-table">
        <div class="filter-row">
          <div class="form-group">
            <label for="filterSymbol">銘柄</label>
            <input type="text" id="filterSymbol" placeholder="すべて">
          </div>
          <div class="form-group">
            <label for="filterTradeType">取引区分</label>
            <select id="filterTradeType">
              <option value="">すべて</option>
              <option value="real">リアル</option>
              <option value="virtual">バーチャル</option>
              <option value="practice">プラクティス</option>
            </select>
          </div>
          <div class="form-group">
            <label for="filterDirection">結果方向</label>
            <select id="filterDirection">
              <option value="">すべて</option>
              <option value="long">ロング</option>
              <option value="short">ショート</option>
              <option value="flat">ノーポジ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="filterStartDate">開始日</label>
            <input type="date" id="filterStartDate">
          </div>
          <div class="form-group">
            <label for="filterEndDate">終了日</label>
            <input type="date" id="filterEndDate">
          </div>
          <div class="form-group filter-buttons">
            <button id="applyFilterBtn" type="button">フィルタ適用</button>
            <button id="resetFilterBtn" type="button">リセット</button>
          </div>
        </div>
        <div class="table-responsive">
          <table id="recordsTable">
            <thead>
              <tr>
                <th>エントリー日時</th>
                <th>銘柄</th>
                <th>時間足</th>
                <th>区分</th>
                <th>エントリー</th>
                <th>結果</th>
                <th>損益</th>
                <th>推奨</th>
                <th>完了</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="recordsTbody">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Charts Column -->
      <div class="charts-column">
        <div class="card chart-card">
          <h3>累積損益</h3>
          <canvas id="chartCumulative" height="200"></canvas>
        </div>
        <div class="card chart-card">
          <h3>ロング/ショート別 勝率＆平均損益</h3>
          <canvas id="chartLongShort" height="200"></canvas>
        </div>
        <div class="card chart-card">
          <h3>時間足別勝率</h3>
          <canvas id="chartTimeframe" height="200"></canvas>
        </div>
      </div>

      <!-- Import/Export Buttons -->
      <div class="analysis-actions button-row">
        <button id="exportBtn" type="button">JSONエクスポート</button>
        <label for="importFile" class="import-label">
          JSONインポート<input type="file" id="importFile" accept="application/json" hidden>
        </label>
      </div>
    </section>
    <footer class="app-disclaimer">
      本アプリの判定結果・分析結果は、過去データ等に基づく参考情報であり、
      将来の収益や損失の発生について何ら保証するものではありません。
      すべての投資判断・トレード判断はご自身の責任において行ってください。
      本アプリの制作者および公開者は、本アプリの利用により生じたいかなる損失についても一切の責任を負いません。
    </footer>
  </div>
  <script src="script.js"></script>
</body>
</html>