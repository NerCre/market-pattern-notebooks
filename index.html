<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>トレード判定・ノートアプリ</title>
    <!-- Main stylesheet -->
    <link rel="stylesheet" href="style.css" />
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="app">
      <h1 class="app-title">トレード判定・ノートアプリ</h1>
      <!-- Tab navigation -->
      <div class="tabs">
        <button class="tab-button active" data-tab="entry">📥 エントリー入力</button>
        <button class="tab-button" data-tab="result">✅ 結果入力</button>
        <button class="tab-button" data-tab="analysis">📊 一覧・分析</button>
      </div>

      <!-- Entry Tab -->
      <section id="tab-entry" class="tab-content active">
        <h2>エントリー情報</h2>
        <div class="entry-grid">
          <!-- Basic Information Card -->
          <div class="card entry-basic">
            <h3>基本情報</h3>
            <div class="form-group">
              <label for="entry-datetime">日時</label>
              <input type="datetime-local" id="entry-datetime" />
            </div>
            <div class="form-group">
              <label for="entry-symbol">銘柄</label>
              <input type="text" id="entry-symbol" value="nk225mc" />
            </div>
            <div class="form-group">
              <label for="entry-timeframe">時間足</label>
              <select id="entry-timeframe">
                <option value="1分">1分</option>
                <option value="5分">5分</option>
                <option value="15分">15分</option>
                <option value="30分">30分</option>
                <option value="1時間">1時間</option>
                <option value="日足">日足</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-tradeType">取引区分</label>
              <select id="entry-tradeType">
                <option value="real">リアル</option>
                <option value="virtual">バーチャル</option>
                <option value="practice">プラクティス</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-directionPlanned">想定方向</label>
              <select id="entry-directionPlanned">
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-price">エントリー価格</label>
              <input type="number" id="entry-price" step="0.01" />
            </div>
            <div class="form-group">
              <label for="entry-size">枚数</label>
              <input type="number" id="entry-size" step="1" />
            </div>
            <div class="form-group">
              <label for="entry-feePerUnit">手数料 (1枚あたり)</label>
              <input type="number" id="entry-feePerUnit" step="0.01" />
            </div>
            <div class="form-group">
              <label for="entry-plannedStopPrice">想定ストップ価格</label>
              <input type="number" id="entry-plannedStopPrice" step="0.01" />
            </div>
            <div class="form-group">
              <label for="entry-plannedLimitPrice">指値価格</label>
              <input type="number" id="entry-plannedLimitPrice" step="0.01" />
            </div>
            <div class="form-group">
              <label for="entry-cutLossPrice">ロスカット価格</label>
              <input type="number" id="entry-cutLossPrice" step="0.01" />
            </div>
          </div>
          <!-- Indicators Card -->
          <div class="card entry-indicators">
            <h3>インジケーター</h3>
            <div class="form-group">
              <label for="entry-trend">EMA5/20/40トレンド</label>
              <select id="entry-trend">
                <option value="Stage1">Stage1</option>
                <option value="Stage2">Stage2</option>
                <option value="Stage3">Stage3</option>
                <option value="Stage4">Stage4</option>
                <option value="Stage5">Stage5</option>
                <option value="Stage6">Stage6</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-priceVsEma200">価格 vs EMA200</label>
              <select id="entry-priceVsEma200">
                <option value="above">価格はEMA200より上</option>
                <option value="below">価格はEMA200より下</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-emaBand">EMA Band</label>
              <select id="entry-emaBand">
                <option value="dark_green">濃緑（強い上昇）</option>
                <option value="light_green">薄緑（上昇気味）</option>
                <option value="neutral">0付近（中立）</option>
                <option value="light_red">薄赤（下落気味）</option>
                <option value="dark_red">濃赤（強い下落）</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-zone">Pivot×ATRゾーン</label>
              <select id="entry-zone">
                <option value="pivot">pivot</option>
                <option value="pivot_R1">pivot〜R1</option>
                <option value="R1">R1</option>
                <option value="R1_R2">R1〜R2</option>
                <option value="R2">R2</option>
                <option value="R2_HBOP">R2〜HBOP</option>
                <option value="HBOP">HBOP</option>
                <option value="over_HBOP">HBOP以上</option>
                <option value="pivot_S1">pivot〜S1</option>
                <option value="S1">S1</option>
                <option value="S1_S2">S1〜S2</option>
                <option value="S2">S2</option>
                <option value="S2_LBOP">S2〜LBOP</option>
                <option value="LBOP">LBOP</option>
                <option value="under_LBOP">LBOP以下</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-cmfSign">CMF圏域</label>
              <select id="entry-cmfSign">
                <option value="positive">プラス圏</option>
                <option value="near_zero">ゼロ付近</option>
                <option value="negative">マイナス圏</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-cmfSmaDir">CMF SMA方向</label>
              <select id="entry-cmfSmaDir">
                <option value="gc">GC</option>
                <option value="up">上昇</option>
                <option value="flat">横ばい</option>
                <option value="down">下降</option>
                <option value="dc">DC</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-macdState">MACD状態</label>
              <select id="entry-macdState">
                <option value="post_gc">GC後</option>
                <option value="post_dc">DC後</option>
                <option value="neutral">その他</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-rocSign">ROC圏域</label>
              <select id="entry-rocSign">
                <option value="positive">プラス圏</option>
                <option value="near_zero">ゼロ付近</option>
                <option value="negative">マイナス圏</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-rocSmaDir">ROC SMA方向</label>
              <select id="entry-rocSmaDir">
                <option value="up">上昇</option>
                <option value="flat">横ばい</option>
                <option value="down">下降</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entry-rsiZone">RSIゾーン</label>
              <select id="entry-rsiZone">
                <option value="over70">70〜</option>
                <option value="50to70">50〜70</option>
                <option value="around50">50付近</option>
                <option value="30to50">30〜50</option>
                <option value="under30">0〜30</option>
              </select>
            </div>
          </div>
          <!-- Memo and Attachments Card -->
          <div class="card entry-memo">
            <h3>メモ・リンク・画像</h3>
            <div class="form-group">
              <label for="entry-marketMemo">相場状況メモ</label>
              <textarea id="entry-marketMemo" rows="6"></textarea>
            </div>
            <div class="form-group">
              <label for="entry-notionUrl">Notion URL</label>
              <input type="url" id="entry-notionUrl" />
            </div>
            <div class="form-group">
              <label for="entry-imageData">画像添付</label>
              <input type="file" id="entry-imageData" accept="image/*" />
              <div id="entry-imagePreview" class="image-preview"></div>
            </div>
            <div class="form-group">
              <button id="btnVoiceInput" type="button" class="voice-button">🎤 音声入力</button>
            </div>
          </div>
        </div>
        <!-- Action Buttons -->
        <div class="button-row entry-actions">
          <button id="btnJudge" type="button">判定する</button>
          <button id="btnJudgeSave" type="button">判定してエントリーを保存</button>
        </div>
        <!-- Judge Result Display -->
        <div id="judgeResult" class="card judge-result" style="display:none;"></div>
      </section>

      <!-- Result Tab -->
      <section id="tab-result" class="tab-content">
        <h2>結果入力</h2>
        <div class="result-grid">
          <!-- Record Selection -->
          <div class="card result-list">
            <h3>レコード選択</h3>
            <div class="form-group">
              <label for="result-record-select">エントリー一覧</label>
              <select id="result-record-select"></select>
            </div>
          </div>
          <!-- Result Form -->
          <div class="card result-form">
            <h3>結果情報</h3>
            <div class="form-group">
              <label for="result-exitDatetime">決済日時</label>
              <input type="datetime-local" id="result-exitDatetime" />
            </div>
            <div class="form-group">
              <label for="result-exitPrice">決済価格</label>
              <input type="number" id="result-exitPrice" step="0.01" />
            </div>
            <div class="form-group">
              <label for="result-directionTaken">実際に取った方向</label>
              <select id="result-directionTaken">
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="result-size">枚数</label>
              <input type="number" id="result-size" step="1" />
            </div>
            <div class="form-group">
              <label for="result-feePerUnit">手数料 (1枚あたり)</label>
              <input type="number" id="result-feePerUnit" step="0.01" />
            </div>
            <div class="form-group">
              <label for="result-highDuringTrade">トレード中の最高値</label>
              <input type="number" id="result-highDuringTrade" step="0.01" />
            </div>
            <div class="form-group">
              <label for="result-lowDuringTrade">トレード中の最安値</label>
              <input type="number" id="result-lowDuringTrade" step="0.01" />
            </div>
            <div class="form-group">
              <label for="result-memo">メモ</label>
              <textarea id="result-memo" rows="4"></textarea>
            </div>
            <div class="form-group">
              <label>損益</label>
              <div id="result-profit-display" class="profit-display">0</div>
            </div>
            <div class="button-row">
              <button id="btnSaveResult" type="button">結果を保存</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Analysis Tab -->
      <section id="tab-analysis" class="tab-content">
        <h2>一覧・分析</h2>
        <!-- Filters and Table -->
        <div class="card analysis-table-card">
          <h3>フィルタ &amp; 一覧</h3>
          <div class="analysis-filters">
            <div class="form-group">
              <label for="filter-symbol">銘柄</label>
              <input type="text" id="filter-symbol" placeholder="例: nk225mc" />
            </div>
            <div class="form-group">
              <label for="filter-tradeType">取引区分</label>
              <select id="filter-tradeType">
                <option value="all">すべて</option>
                <option value="real">リアル</option>
                <option value="virtual">バーチャル</option>
                <option value="practice">プラクティス</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-directionTaken">結果方向</label>
              <select id="filter-directionTaken">
                <option value="all">すべて</option>
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </div>
            <div class="form-group">
              <label for="filter-startDate">開始日</label>
              <input type="date" id="filter-startDate" />
            </div>
            <div class="form-group">
              <label for="filter-endDate">終了日</label>
              <input type="date" id="filter-endDate" />
            </div>
            <div class="form-group apply-filter-group">
              <button id="btnApplyFilter" type="button">フィルタ適用</button>
            </div>
          </div>
          <div class="records-table-wrapper">
            <table id="recordsTable" class="records-table">
              <thead>
                <tr>
                  <th>エントリー日時</th>
                  <th>銘柄</th>
                  <th>時間足</th>
                  <th>取引区分</th>
                  <th>結果方向</th>
                  <th>損益</th>
                  <th>推奨</th>
                  <th>完了</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <!-- Charts Column -->
        <div class="charts-column">
          <div class="card chart-card">
            <h3>累積損益</h3>
            <canvas id="chartCumulative"></canvas>
          </div>
          <div class="card chart-card">
            <h3>方向別 勝率 &amp; 平均損益</h3>
            <canvas id="chartDirection"></canvas>
          </div>
          <div class="card chart-card">
            <h3>時間足別 勝率</h3>
            <canvas id="chartTimeframe"></canvas>
          </div>
        </div>
        <!-- JSON Import/Export -->
        <div class="json-actions">
          <button id="btnExport" type="button">JSONエクスポート</button>
          <label class="import-label">
            JSONインポート
            <input type="file" id="jsonImportInput" accept="application/json" style="display:none;" />
          </label>
        </div>
      </section>
    </div>
    <!-- Main script -->
    <script src="script.js"></script>
  </body>
</html>