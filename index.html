<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>トレード判定・ノートアプリ</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>トレード判定・ノートアプリ</h1>
      <nav class="tabs">
        <button class="tab active" data-target="entry-tab">📥 エントリー入力</button>
        <button class="tab" data-target="result-tab">✅ 結果入力</button>
        <button class="tab" data-target="analysis-tab">📊 一覧・分析</button>
      </nav>
    </header>

    <!-- エントリー入力タブ -->
    <section id="entry-tab" class="tab-content active">
      <h2>エントリー情報</h2>
      <form id="entry-form">
        <div class="form-grid">
          <!-- エントリー基本情報 -->
          <div class="form-section">
            <h3>基本情報</h3>
            <label>日時*<input type="datetime-local" id="entry-datetime" required /></label>
            <label>銘柄*<input type="text" id="entry-symbol" value="nk225mc" required /></label>
            <label>時間足*
              <select id="entry-timeframe" required>
                <option value="1m">1分</option>
                <option value="5m">5分</option>
                <option value="15m">15分</option>
                <option value="30m">30分</option>
                <option value="1h">1時間</option>
                <option value="1d">日足</option>
              </select>
            </label>
            <label>取引区分*
              <select id="entry-tradeType" required>
                <option value="real">リアル</option>
                <option value="virtual">バーチャル</option>
                <option value="practice">プラクティス</option>
              </select>
            </label>
            <label>想定方向*
              <select id="entry-directionPlanned" required>
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジで様子見</option>
              </select>
            </label>
            <label>エントリー価格*<input type="number" step="0.01" id="entry-price" required /></label>
            <label>枚数*<input type="number" id="entry-size" required /></label>
            <label>1枚あたりの手数料*<input type="number" step="0.01" id="entry-fee" required /></label>
            <label>想定ストップ価格<input type="number" step="0.01" id="entry-stop" /></label>
            <label>指値価格<input type="number" step="0.01" id="entry-limit" /></label>
            <label>ロスカット価格<input type="number" step="0.01" id="entry-cutloss" /></label>
          </div>

          <!-- インジケーター入力 -->
          <div class="form-section">
            <h3>インジケーター</h3>
            <label>EMA5/20/40トレンド*
              <select id="entry-trend" required>
                <option value="bull">上昇（EMA5＞EMA20＞EMA40）</option>
                <option value="bear">下降（EMA5＜EMA20＜EMA40）</option>
                <option value="mixed">もみ合い・交錯</option>
              </select>
            </label>
            <label>価格 vs EMA200*
              <select id="entry-price-ema200" required>
                <option value="above">価格がEMA200より上</option>
                <option value="below">価格がEMA200より下</option>
              </select>
            </label>
            <label>EMA Band*
              <select id="entry-ema-band" required>
                <option value="dark_green">濃緑（強い上昇）</option>
                <option value="light_green">薄緑（上昇気味）</option>
                <option value="neutral">0付近（中立〜転換）</option>
                <option value="light_red">薄赤（下落気味）</option>
                <option value="dark_red">濃赤（強い下落）</option>
              </select>
            </label>
            <label>Pivot×ATRゾーン*
              <select id="entry-zone" required>
                <option value="pivot">pivot</option>
                <option value="pivot_R1">pivot〜R1</option>
                <option value="R1">R1</option>
                <option value="R1_R2">R1〜R2</option>
                <option value="R2">R2</option>
                <option value="R2_HBOP">R2〜HBOP</option>
                <option value="HBOP">HBOP</option>
                <option value="over_HBOP">HBOP以上</option>
                <option value="pivot_S1">pivot〜S1</option>
                <option value="S1">S1</option>
                <option value="S1_S2">S1〜S2</option>
                <option value="S2">S2</option>
                <option value="S2_LBOP">S2〜LBOP</option>
                <option value="LBOP">LBOP</option>
                <option value="under_LBOP">LBOP以下</option>
              </select>
            </label>
            <label>CMF圏域*
              <select id="entry-cmf-sign" required>
                <option value="positive">プラス圏</option>
                <option value="near_zero">ゼロ付近</option>
                <option value="negative">マイナス圏</option>
              </select>
            </label>
            <label>CMF SMA方向*
              <select id="entry-cmf-dir" required>
                <option value="up">上昇</option>
                <option value="down">下降</option>
                <option value="flat">ほぼ横ばい</option>
              </select>
            </label>
            <label>ROC圏域*
              <select id="entry-roc-sign" required>
                <option value="positive">プラス圏</option>
                <option value="near_zero">ゼロ付近</option>
                <option value="negative">マイナス圏</option>
              </select>
            </label>
            <label>ROC SMA方向*
              <select id="entry-roc-dir" required>
                <option value="up">上昇</option>
                <option value="down">下降</option>
                <option value="flat">ほぼ横ばい</option>
              </select>
            </label>
            <label>MACD状態*
              <select id="entry-macd" required>
                <option value="post_gc">GC後</option>
                <option value="post_dc">DC後</option>
                <option value="neutral">ニュートラル</option>
              </select>
            </label>
            <label>RSIゾーン*
              <select id="entry-rsi" required>
                <option value="under30">0〜30</option>
                <option value="30to50">30〜50</option>
                <option value="50to70">50〜70</option>
                <option value="over70">70以上</option>
              </select>
            </label>
          </div>

          <!-- メモ・画像・音声 -->
          <div class="form-section">
            <h3>メモ・画像・音声</h3>
            <label>相場状況メモ<textarea id="entry-marketMemo" rows="4" placeholder="日足・1時間足の印象やニュース要因などを記入してください"></textarea></label>
            <div class="file-input">
              <label>画像添付
                <input type="file" id="entry-image" accept="image/*" />
              </label>
              <img id="entry-image-preview" class="image-preview" alt="プレビュー" />
            </div>
            <button type="button" id="entry-voice" class="secondary">🎤 音声入力</button>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" id="predict-btn" class="primary">判定する</button>
          <button type="button" id="predict-save-btn" class="primary">判定してエントリーを保存</button>
        </div>
        <div id="prediction-output" class="output"></div>
        <div id="entry-error" class="error"></div>
      </form>
    </section>

    <!-- 結果入力タブ -->
    <section id="result-tab" class="tab-content">
      <h2>結果入力</h2>
      <div id="result-selection">
        <label>エントリー選択*
          <select id="result-entry-select"></select>
        </label>
      </div>
      <form id="result-form">
        <div class="form-grid">
          <div class="form-section" id="result-entry-info">
            <!-- 選択したエントリー情報を表示 -->
          </div>
          <div class="form-section">
            <h3>結果入力</h3>
            <label>決済日時*<input type="datetime-local" id="result-datetimeExit" required /></label>
            <label>実際の決済価格*<input type="number" step="0.01" id="result-exitPrice" required /></label>
            <label>実際に取った方向*
              <select id="result-directionTaken" required>
                <option value="long">ロング</option>
                <option value="short">ショート</option>
                <option value="flat">ノーポジ</option>
              </select>
            </label>
            <label>枚数*<input type="number" id="result-size" required /></label>
            <label>1枚あたりの手数料*<input type="number" step="0.01" id="result-fee" required /></label>
            <label>トレード中の最高値<input type="number" step="0.01" id="result-high" /></label>
            <label>トレード中の最安値<input type="number" step="0.01" id="result-low" /></label>
            <label>メモ<textarea id="result-note" rows="3" placeholder="結果に関するメモ"></textarea></label>
            <div class="info">損益: <span id="result-profit">0</span></div>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" id="result-save-btn" class="primary">結果を保存</button>
        </div>
        <div id="result-error" class="error"></div>
      </form>
    </section>

    <!-- 一覧・分析タブ -->
    <section id="analysis-tab" class="tab-content">
      <h2>一覧・分析</h2>
      <!-- フィルタ -->
      <div class="filters">
        <label>銘柄<input type="text" id="filter-symbol" /></label>
        <label>時間足<select id="filter-timeframe"><option value="">すべて</option><option value="1m">1分</option><option value="5m">5分</option><option value="15m">15分</option><option value="30m">30分</option><option value="1h">1時間</option><option value="1d">日足</option></select></label>
        <label>取引区分<select id="filter-tradeType"><option value="">すべて</option><option value="real">リアル</option><option value="virtual">バーチャル</option><option value="practice">プラクティス</option></select></label>
        <label>完了状態<select id="filter-hasResult"><option value="">すべて</option><option value="true">完了</option><option value="false">未完了</option></select></label>
        <label>日付開始<input type="date" id="filter-startDate" /></label>
        <label>日付終了<input type="date" id="filter-endDate" /></label>
        <button type="button" id="filter-reset" class="secondary">フィルタリセット</button>
      </div>
      <!-- 一覧テーブル -->
      <table id="records-table">
        <thead>
          <tr>
            <th data-sort="datetimeEntry">エントリー日時</th>
            <th data-sort="symbol">銘柄</th>
            <th data-sort="timeframe">時間足</th>
            <th data-sort="tradeType">取引区分</th>
            <th data-sort="directionTaken">結果方向</th>
            <th data-sort="profit">損益</th>
            <th data-sort="recommendation">推奨</th>
            <th data-sort="hasResult">完了</th>
            <th>編集</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <!-- グラフ -->
      <div class="charts">
        <canvas id="chart-cumulative"></canvas>
        <canvas id="chart-longshort"></canvas>
        <canvas id="chart-timeframe"></canvas>
      </div>
      <!-- エクスポート・インポート -->
      <div class="export-import">
        <button type="button" id="export-json" class="secondary">📤 JSONエクスポート</button>
        <label class="import-btn">📥 JSONインポート<input type="file" id="import-json" accept="application/json" /></label>
      </div>
      <div id="import-result" class="info"></div>
    </section>
  </div>
</body>
</html>